{% load static %}
{% load custom_filters %}

<div class="session-card glassmorphism flex flex-col lg:flex-row rounded-lg overflow-hidden shadow-md transition-all hover:shadow-lg hover:transform hover:translate-y-[-2px] mb-4">
    <!-- Session thumbnail -->
    <div class="session-thumbnail relative lg:w-1/4">
        <div class="bg-gradient-to-r from-primary to-accent-dark aspect-video lg:h-full overflow-hidden">
            {% if session.thumbnail %}
                <img src="{{ session.thumbnail.url }}" alt="{{ session.title }}" class="w-full h-full object-cover">
            {% else %}
                <div class="w-full h-full flex items-center justify-center">
                    <i data-feather="video" class="text-white h-10 w-10"></i>
                </div>
            {% endif %}
        </div>
        
        <!-- Live badge or status badge -->
        {% if session.is_live %}
            <div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-md text-xs font-medium flex items-center">
                <span class="animate-pulse rounded-full bg-white h-2 w-2 mr-1"></span>
                LIVE
            </div>
        {% else %}
            <div class="absolute top-2 left-2 bg-gray-700 bg-opacity-70 text-white px-2 py-1 rounded-md text-xs font-medium">
                {{ session.status|upper }}
            </div>
        {% endif %}
        
        <!-- Domain badge -->
        <div class="absolute bottom-2 left-2 bg-accent text-white px-2 py-1 rounded-md text-xs font-medium">
            {{ session.domain }}
        </div>
    </div>
    
    <!-- Session details -->
    <div class="session-details p-4 flex-1 flex flex-col justify-between">
        <div>
            <!-- Title and mentor info -->
            <div class="flex justify-between items-start mb-2">
                <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">{{ session.title }}</h3>
                <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">{{ session.duration }} min</span>
            </div>
            
            <!-- Mentor info -->
            <div class="flex items-center mb-3">
                <div class="flex-shrink-0 mr-2">
                    {% if session.mentor.profile_picture %}
                        <img src="{{ session.mentor.profile_picture.url }}" alt="{{ session.mentor.user.first_name }}" class="w-8 h-8 rounded-full object-cover">
                    {% else %}
                        <div class="w-8 h-8 rounded-full bg-accent-dark flex items-center justify-center text-white">
                            {{ session.mentor.user.first_name|first|upper }}
                        </div>
                    {% endif %}
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-900 dark:text-gray-100">{{ session.mentor.user.get_full_name }}</p>
                    <div class="flex items-center">
                        <div class="flex text-yellow-400">
                            {% if session.mentor.avg_rating %}
                                {% for i in "12345" %}
                                    {% if forloop.counter <= session.mentor.avg_rating|floatformat:0|add:"0" %}
                                        <i data-feather="star" class="h-3 w-3 fill-current"></i>
                                    {% else %}
                                        <i data-feather="star" class="h-3 w-3"></i>
                                    {% endif %}
                                {% endfor %}
                                <span class="text-xs text-gray-500 dark:text-gray-400 ml-1">({{ session.mentor.rating_count }})</span>
                            {% else %}
                                <span class="text-xs text-gray-500 dark:text-gray-400">New mentor</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Session description -->
            <p class="text-gray-700 dark:text-gray-300 text-sm mb-3 line-clamp-2">{{ session.description|truncatechars:120 }}</p>
            
            <!-- Topics covered -->
            <div class="mb-3">
                <h4 class="text-xs uppercase text-gray-500 dark:text-gray-400 mb-1">Topics covered:</h4>
                <div class="flex flex-wrap gap-1">
                    {% for topic in session.topics.all|slice:":3" %}
                        <span class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 text-xs px-2 py-1 rounded">{{ topic.name }}</span>
                    {% empty %}
                        <span class="text-gray-500 dark:text-gray-400 text-xs">Topics not specified</span>
                    {% endfor %}
                    {% if session.topics.all|length > 3 %}
                        <span class="text-gray-500 dark:text-gray-400 text-xs">+{{ session.topics.all|length|add:"-3" }} more</span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Session footer: Time, price, and button -->
        <div class="flex flex-col sm:flex-row justify-between items-center mt-2">
            <div class="flex items-center mb-2 sm:mb-0">
                <i data-feather="calendar" class="h-4 w-4 text-gray-500 dark:text-gray-400 mr-1"></i>
                <span class="text-sm text-gray-700 dark:text-gray-300">{{ session.start_time|date:"M d, Y • g:i A" }}</span>
            </div>
            
            <div class="flex items-center">
                <span class="text-lg font-semibold {% if session.price == 0 %}text-primary{% else %}text-gray-800 dark:text-gray-200{% endif %} mr-4">
                    {% if session.price == 0 %}
                        Free
                    {% else %}
                        ₹{{ session.price }}
                    {% endif %}
                </span>
                
                {% if session.is_live %}
                    <a href="{% url 'session_room' session.id %}" class="btn btn-primary btn-sm">Join Now</a>
                {% elif session.is_upcoming %}
                    <a href="{% url 'session_details' session.id %}" class="btn btn-primary-outline btn-sm">Book Now</a>
                {% else %}
                    <a href="{% url 'session_details' session.id %}" class="btn btn-primary-outline btn-sm">View Details</a>
                {% endif %}
            </div>
        </div>
    </div>
</div>